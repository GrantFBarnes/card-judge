{{define "body"}}
<script src="/static/js/lobby.js"></script>
<link
    rel="stylesheet"
    href="/static/css/lobby.css"
/>
<div id="lobby-grid-container">
    <div
        id="lobby-grid-interface"
        hx-get="/api/lobby/{{.Lobby.Id}}/html/game-interface"
        hx-trigger="load"
    ></div>
    <div id="lobby-chat">
        <div id="lobby-chat-messages"></div>
        <form id="lobby-chat-form">
            <input
                id="lobby-chat-input"
                type="text"
                maxlength="255"
                placeholder="Send a message..."
            />
            <input
                id="lobby-chat-submit"
                type="submit"
                value="Send Message"
            />
            <button
                hx-post="/api/lobby/{{.Lobby.Id}}/flip"
                hx-confirm="Are you sure you want to flip the table and leave?"
            >
                Flip the Table!
            </button>
        </form>
    </div>
</div>
{{if .Lobby.Message.Valid}}
<dialog id="lobby-message-dialog">
    <div style="display: grid; grid-auto-flow: column">
        <div>
            <h3>{{.Lobby.Name}}</h3>
            <p>{{.Lobby.Message.String}}</p>
        </div>
        <div>
            <span
                class="bi bi-x-lg close-button"
                onclick="document.getElementById('lobby-message-dialog').close()"
            ></span>
        </div>
    </div>
</dialog>
{{end}}
<dialog id="lobby-alert-dialog">
    <div style="display: grid; grid-auto-flow: column">
        <div>
            <h3 id="lobby-alert-dialog-header"></h3>
            <p id="lobby-alert-dialog-body"></p>
        </div>
    </div>
</dialog>
<dialog id="lobby-update-dialog">
    <div style="display: grid; grid-auto-flow: column">
        <div>
            <h3>Edit Lobby</h3>
        </div>
        <div>
            <span
                class="bi bi-x-lg close-button"
                onclick="document.getElementById('lobby-update-dialog').close()"
            ></span>
        </div>
    </div>
    <form
        hx-put="/api/lobby/{{.Lobby.Id}}/name"
        hx-target="find .htmx-result"
    >
        <table>
            <colgroup>
                <col style="width: 200px;">
                <col style="width: 200px;">
                <col style="width: 50px;">
                <col style="width: auto;">
            </colgroup>
            <tbody>
                <tr>
                    <td>Name:</td>
                    <td>
                        <input
                            type="text"
                            name="name"
                            maxlength="255"
                            placeholder="Enter Name"
                            required="required"
                            autocomplete="off"
                        />
                    </td>
                    <td>
                        <input
                            type="submit"
                            value="Update"
                        />
                    </td>
                    <td>
                        <div class="htmx-result"></div>
                    </td>
                </tr>
            </tbody>
        </table>
    </form>
    <form
        hx-put="/api/lobby/{{.Lobby.Id}}/message"
        hx-target="find .htmx-result"
    >
        <table>
            <colgroup>
                <col style="width: 200px;">
                <col style="width: 200px;">
                <col style="width: 50px;">
                <col style="width: auto;">
            </colgroup>
            <tbody>
                <tr>
                    <td>Message:</td>
                    <td>
                        <input
                            type="text"
                            name="message"
                            maxlength="255"
                            placeholder="Enter Message"
                            autocomplete="off"
                        />
                    </td>
                    <td>
                        <input
                            type="submit"
                            value="Update"
                        />
                    </td>
                    <td>
                        <div class="htmx-result"></div>
                    </td>
                </tr>
            </tbody>
        </table>
    </form>
    <form
        hx-put="/api/lobby/{{.Lobby.Id}}/draw-priority"
        hx-target="find .htmx-result"
    >
        <table>
            <colgroup>
                <col style="width: 200px;">
                <col style="width: 200px;">
                <col style="width: 50px;">
                <col style="width: auto;">
            </colgroup>
            <tbody>
                <tr>
                    <td>Draw Priority:</td>
                    <td>
                        <select
                            name="drawPriority"
                            required="required"
                            autocomplete="off"
                        >
                            <option
                                value="RANDOM"
                                selected
                            >Random</option>
                            <option value="PLAYCOUNT">Play Count</option>
                        </select>
                    </td>
                    <td>
                        <input
                            type="submit"
                            value="Update"
                        />
                    </td>
                    <td>
                        <div class="htmx-result"></div>
                    </td>
                </tr>
            </tbody>
        </table>
    </form>
    <form
        hx-put="/api/lobby/{{.Lobby.Id}}/hand-size"
        hx-target="find .htmx-result"
    >
        <table>
            <colgroup>
                <col style="width: 200px;">
                <col style="width: 200px;">
                <col style="width: 50px;">
                <col style="width: auto;">
            </colgroup>
            <tbody>
                <tr>
                    <td>Hand Size:</td>
                    <td>
                        <select
                            name="handSize"
                            required="required"
                            autocomplete="off"
                        >
                            <option value="6">6</option>
                            <option
                                value="8"
                                selected
                            >8</option>
                            <option value="10">10</option>
                            <option value="12">12</option>
                            <option value="14">14</option>
                            <option value="16">16</option>
                        </select>
                    </td>
                    <td>
                        <input
                            type="submit"
                            value="Update"
                        />
                    </td>
                    <td>
                        <div class="htmx-result"></div>
                    </td>
                </tr>
            </tbody>
        </table>
    </form>
    <form
        hx-put="/api/lobby/{{.Lobby.Id}}/free-credits"
        hx-target="find .htmx-result"
    >
        <table>
            <colgroup>
                <col style="width: 200px;">
                <col style="width: 200px;">
                <col style="width: 50px;">
                <col style="width: auto;">
            </colgroup>
            <tbody>
                <tr>
                    <td>Free Credits:</td>
                    <td>
                        <select
                            name="freeCredits"
                            required="required"
                            autocomplete="off"
                        >
                            <option value="0">0</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option
                                value="3"
                                selected
                            >3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                            <option value="9">9</option>
                            <option value="10">10</option>
                        </select>
                    </td>
                    <td>
                        <input
                            type="submit"
                            value="Update"
                        />
                    </td>
                    <td>
                        <div class="htmx-result"></div>
                    </td>
                </tr>
            </tbody>
        </table>
    </form>
    <form
        hx-put="/api/lobby/{{.Lobby.Id}}/win-streak-threshold"
        hx-target="find .htmx-result"
    >
        <table>
            <colgroup>
                <col style="width: 200px;">
                <col style="width: 200px;">
                <col style="width: 50px;">
                <col style="width: auto;">
            </colgroup>
            <tbody>
                <tr>
                    <td>Win Streak Threshold:</td>
                    <td>
                        <select
                            name="winStreakThreshold"
                            required="required"
                            autocomplete="off"
                        >
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option
                                value="3"
                                selected
                            >3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                        </select>
                    </td>
                    <td>
                        <input
                            type="submit"
                            value="Update"
                        />
                    </td>
                    <td>
                        <div class="htmx-result"></div>
                    </td>
                </tr>
            </tbody>
        </table>
    </form>
    <form
        hx-put="/api/lobby/{{.Lobby.Id}}/lose-streak-threshold"
        hx-target="find .htmx-result"
    >
        <table>
            <colgroup>
                <col style="width: 200px;">
                <col style="width: 200px;">
                <col style="width: 50px;">
                <col style="width: auto;">
            </colgroup>
            <tbody>
                <tr>
                    <td>Lose Streak Threshold:</td>
                    <td>
                        <select
                            name="loseStreakThreshold"
                            required="required"
                            autocomplete="off"
                        >
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option
                                value="3"
                                selected
                            >3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                        </select>
                    </td>
                    <td>
                        <input
                            type="submit"
                            value="Update"
                        />
                    </td>
                    <td>
                        <div class="htmx-result"></div>
                    </td>
                </tr>
            </tbody>
        </table>
    </form>
</dialog>
<dialog id="lobby-draw-pile-dialog">
    <div style="display: grid; grid-auto-flow: column">
        <div>
            <h3>Lobby Draw Pile</h3>
        </div>
        <div>
            <span
                class="bi bi-x-lg close-button"
                onclick="document.getElementById('lobby-draw-pile-dialog').close()"
            ></span>
        </div>
    </div>
    <form
        hx-put="/api/lobby/{{.Lobby.Id}}/set-decks"
        hx-target="find .htmx-result"
    >
        {{$deckCount := len .Decks}}
        {{if gt $deckCount 0}}
        <h3>Choose Decks</h3>
        <table style="max-height: 200px">
            <tbody>
                {{range .Decks}}
                <tr>
                    <td>
                        <input
                            id="deckSelect{{.Id}}"
                            type="checkbox"
                            name="deckId{{.Id}}"
                            value="{{.Id}}"
                            autocomplete="off"
                        />
                        <label
                            for="deckSelect{{.Id}}"
                            class="clickable"
                        >{{.Name}}</label>
                    </td>
                </tr>
                {{end}}
            </tbody>
        </table>
        {{end}}
        <br />
        <details>
            <summary>Missing decks?</summary>
            <p>Go <a
                    href="/decks"
                    target="_blank"
                    rel="noopener noreferrer"
                >here</a> to access/create some.</p>
        </details>
        <br />
        <br />
        <div class="htmx-result"></div>
        <input
            type="submit"
            value="Set Decks"
        />
    </form>
</dialog>
<dialog id="purchase-credits-dialog">
    <div style="display: grid; grid-auto-flow: column">
        <div>
            <h3>Purchase Credits</h3>
        </div>
        <div>
            <span
                class="bi bi-x-lg close-button"
                onclick="document.getElementById('purchase-credits-dialog').close()"
            ></span>
        </div>
    </div>
    <p style="text-align: center">
        Additional <b>Game Credits</b> can be purchased to help give you an advantage over your opponents.
        <br />
        <br />
        <button
            hx-post="/api/lobby/{{.Lobby.Id}}/purchase-credits"
            hx-target="closest p"
        >
            Purchase Credits
        </button>
    </p>
</dialog>
<dialog id="find-card-dialog">
    <div style="display: grid; grid-auto-flow: column">
        <div>
            <h3>Find Card</h3>
            <h5><i>Find a card in the draw pile to play</i></h5>
        </div>
        <div>
            <span
                class="bi bi-x-lg close-button"
                onclick="document.getElementById('find-card-dialog').close()"
            ></span>
        </div>
    </div>
    <form
        hx-post="/api/card/find"
        hx-trigger="input change delay:500ms"
        hx-target="#find-card-table-rows"
    >
        <input
            type="text"
            name="lobbyId"
            value="{{.Lobby.Id}}"
            hidden
        />
        <label for="textSearch">Text:</label>
        <input
            type="search"
            id="textSearch"
            name="text"
            maxlength="510"
            placeholder="Search..."
            autocomplete="off"
        />
    </form>
    <br />
    <table>
        <tbody id="find-card-table-rows"></tbody>
    </table>
</dialog>
<dialog id="wild-card-dialog">
    <div style="display: grid; grid-auto-flow: column">
        <div>
            <h3>Create Wild Card</h3>
            <h5><i>A temporary card played for this round only</i></h5>
        </div>
        <div>
            <span
                class="bi bi-x-lg close-button"
                onclick="document.getElementById('wild-card-dialog').close()"
            ></span>
        </div>
    </div>
    <form
        hx-post="/api/lobby/{{.Lobby.Id}}/card/wild/play"
        hx-target="find .htmx-result"
        hx-confirm="Are you sure you want to play this Wild Card?"
    >
        <div class="form-input">
            <label
                for="wildCardText"
                style="vertical-align: top"
            >Text</label>
            <textarea
                id="wildCardText"
                name="text"
                maxlength="255"
                placeholder="Enter Wild Card Text"
                required="required"
                cols="40"
                rows="10"
                autocomplete="off"
            ></textarea>
        </div>
        <br />
        <div class="htmx-result"></div>
        <input
            type="submit"
            value="Play Wild Card"
            onclick="document.getElementById('wild-card-dialog').close()"
        />
    </form>
</dialog>
<dialog id="table-flipped-dialog">
    <img
        src="/static/images/flip-table.gif"
        alt="Table Flipped"
    />
</dialog>
<dialog id="player-kicked-dialog">
    <img
        src="/static/images/kick.gif"
        alt="Player Kicked"
    />
</dialog>
{{end}}