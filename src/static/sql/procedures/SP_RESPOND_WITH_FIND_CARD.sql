CREATE
OR REPLACE PROCEDURE SP_RESPOND_WITH_FIND_CARD(
    IN VAR_PLAYER_ID UUID,
    IN VAR_CARD_ID UUID
)
BEGIN
    DECLARE VAR_LOBBY_ID UUID DEFAULT (
            SELECT
                LOBBY_ID
            FROM PLAYER
            WHERE ID = VAR_PLAYER_ID
        );

    IF EXISTS(
        SELECT
            ID
        FROM DRAW_PILE
        WHERE LOBBY_ID = VAR_LOBBY_ID
            AND CARD_ID = VAR_CARD_ID
    ) THEN
        DELETE
        FROM DRAW_PILE
        WHERE LOBBY_ID = VAR_LOBBY_ID
            AND CARD_ID = VAR_CARD_ID;

        CALL SP_SPEND_CREDITS(
                VAR_PLAYER_ID,
                FN_GET_SPECIAL_COST(VAR_PLAYER_ID, 'FIND'),
                'FIND'
            );

        CALL SP_RESPOND_WITH_CARD(VAR_PLAYER_ID, VAR_CARD_ID, 'FIND');
    END
    IF;
END;